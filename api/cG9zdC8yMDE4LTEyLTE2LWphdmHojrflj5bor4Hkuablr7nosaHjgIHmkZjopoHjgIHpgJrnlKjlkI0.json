{"title":"java获取证书对象、摘要、通用名","date":"2018-12-16T08:16:55.000Z","slug":"2018-12-16-java获取证书对象、摘要、通用名","tags":["PKI"],"updated":"2018-12-16T08:27:32.290Z","content":"<h2 id=\"简要介绍\"><a href=\"#简要介绍\" class=\"headerlink\" title=\"简要介绍\"></a>简要介绍</h2><p>​    通过java的方式来使用PKI常用的API，这里主要实现有：获取证书对象、获取摘要、获取证书CN项</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"构造证书对象\"><a href=\"#构造证书对象\" class=\"headerlink\" title=\"构造证书对象\"></a>构造证书对象</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 构造证书对象</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span>  data      证书的字节数组</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span>           证书对象</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> X509Certificate <span class=\"title\">ParseToCertObj</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] data)</span></span></span><br><span class=\"line\"><span class=\"function\">            <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        CertificateFactory cf = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            cf = CertificateFactory.getInstance(<span class=\"string\">\"X.509\"</span>,<span class=\"string\">\"NetcaWpkiSM2JCE\"</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(Exception e)&#123;</span><br><span class=\"line\">            cf = CertificateFactory.getInstance(<span class=\"string\">\"X.509\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        X509Certificate cert = (X509Certificate) cf.generateCertificate(<span class=\"keyword\">new</span> ByteArrayInputStream(data));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cert;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"获取证书摘要\"><a href=\"#获取证书摘要\" class=\"headerlink\" title=\"获取证书摘要\"></a>获取证书摘要</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">    * 获取摘要</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> data 计算摘要值的原文</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getDigest</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] data)</span> <span class=\"keyword\">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class=\"line\">       MessageDigest digest = MessageDigest.getInstance(<span class=\"string\">\"SHA-1\"</span>);</span><br><span class=\"line\">       digest.update(data);</span><br><span class=\"line\">       <span class=\"keyword\">byte</span>[] dg = digest.digest();</span><br><span class=\"line\">       <span class=\"keyword\">return</span> HexEncoder.encode(dg);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"获取证书CN项\"><a href=\"#获取证书CN项\" class=\"headerlink\" title=\"获取证书CN项\"></a>获取证书CN项</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String dn = x509certificate.getIssuerDN().getName();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 若无CN,依次用OU,O,EMAILADDRESS代替 </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">GetCNFromDN</span><span class=\"params\">(String dn)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> begin = dn.indexOf(<span class=\"string\">\"CN=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            begin = dn.indexOf(<span class=\"string\">\"OU=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            begin = dn.indexOf(<span class=\"string\">\"O=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            begin = dn.indexOf(<span class=\"string\">\"EMAILADDRESS=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> dn;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> begin2 = dn.indexOf(<span class=\"string\">\"=\"</span>, begin);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> end = dn.indexOf(<span class=\"string\">\",\"</span>, begin2);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (end &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            end = dn.length();</span><br><span class=\"line\">        String CN = dn.substring(begin2 + <span class=\"number\">1</span>, end);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (CN.startsWith(<span class=\"string\">\"\\\"\"</span>) &amp;&amp; CN.endsWith(<span class=\"string\">\"\\\"\"</span>))</span><br><span class=\"line\">            CN = CN.substring(<span class=\"number\">1</span>, CN.length() - <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> CN;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"all\"><a href=\"#all\" class=\"headerlink\" title=\"all\"></a>all</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> net.netca.seal.importdatabase.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.ByteArrayInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.MessageDigest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.NoSuchAlgorithmException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.cert.CertificateFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.cert.X509Certificate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PKIUtils</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 构造证书对象</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span>  data      证书的字节数组</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span>           证书对象</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> X509Certificate <span class=\"title\">ParseToCertObj</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] data)</span></span></span><br><span class=\"line\"><span class=\"function\">            <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        CertificateFactory cf = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            cf = CertificateFactory.getInstance(<span class=\"string\">\"X.509\"</span>,<span class=\"string\">\"NetcaWpkiSM2JCE\"</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(Exception e)&#123;</span><br><span class=\"line\">            cf = CertificateFactory.getInstance(<span class=\"string\">\"X.509\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        X509Certificate cert = (X509Certificate) cf.generateCertificate(<span class=\"keyword\">new</span> ByteArrayInputStream(data));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cert;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * 获取摘要</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> data 计算摘要值的原文</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getDigest</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] data)</span> <span class=\"keyword\">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class=\"line\">        MessageDigest digest = MessageDigest.getInstance(<span class=\"string\">\"SHA-1\"</span>);</span><br><span class=\"line\">        digest.update(data);</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] dg = digest.digest();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HexEncoder.encode(dg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 若无CN,依次用OU,O,EMAILADDRESS代替</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">GetCNFromDN</span><span class=\"params\">(String dn)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> begin = dn.indexOf(<span class=\"string\">\"CN=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            begin = dn.indexOf(<span class=\"string\">\"OU=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            begin = dn.indexOf(<span class=\"string\">\"O=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            begin = dn.indexOf(<span class=\"string\">\"EMAILADDRESS=\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (begin &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> dn;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> begin2 = dn.indexOf(<span class=\"string\">\"=\"</span>, begin);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> end = dn.indexOf(<span class=\"string\">\",\"</span>, begin2);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (end &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            end = dn.length();</span><br><span class=\"line\">        String CN = dn.substring(begin2 + <span class=\"number\">1</span>, end);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (CN.startsWith(<span class=\"string\">\"\\\"\"</span>) &amp;&amp; CN.endsWith(<span class=\"string\">\"\\\"\"</span>))</span><br><span class=\"line\">            CN = CN.substring(<span class=\"number\">1</span>, CN.length() - <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> CN;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","next":{"title":"spring-boot2.1+thymeleaf简单的web开发","slug":"2018-12-11-spring-boot2.1+thymeleaf简单的web开发"},"link":"https://pinksmallfan.github.io/WenChongAndJiaoKou/WenChongAndJiaoKou/2018/12/16/2018-12-16-java获取证书对象、摘要、通用名/","toc":[{"title":"简要介绍","id":"简要介绍","index":"1"},{"title":"代码","id":"代码","index":"2","children":[{"title":"构造证书对象","id":"构造证书对象","index":"2.1"},{"title":"获取证书摘要","id":"获取证书摘要","index":"2.2"},{"title":"获取证书CN项","id":"获取证书CN项","index":"2.3"},{"title":"all","id":"all","index":"2.4"}]}]}