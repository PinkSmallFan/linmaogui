{"title":"Linux下最优的tomcat调优","date":"2018-12-03T07:14:23.000Z","slug":"2018-12-3-Linux下最优的tomcat调优","tags":["Linux","Tomcat","配置"],"updated":"2018-12-04T16:19:30.877Z","content":"<ol>\n<li>Linux系统，参数读取命令</li>\n<li>tomcat优化的大致方向，流程</li>\n<li>实践-反馈-知识-反馈-实践</li>\n<li>笔记</li>\n<li>代码流程</li>\n</ol>\n<p>Linux系统配置优化建议：<a href=\"https://www.jianshu.com/p/98a14527afdc\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/p/98a14527afdc</a></p>\n<p>Tomcat系统配置优化建议：<a href=\"http://blog.sina.com.cn/s/blog_605f5b4f01012ljj.html\" target=\"_blank\" rel=\"noopener\">http://blog.sina.com.cn/s/blog_605f5b4f01012ljj.html</a></p>\n<p>Tomcat系统参数详解：<a href=\"https://www.cnblogs.com/kismetv/p/7806063.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/kismetv/p/7806063.html</a></p>\n<p>JVM查看java内存情况：<a href=\"https://www.cnblogs.com/anjijiji/p/6239395.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/anjijiji/p/6239395.html</a></p>\n<p>远程连接Linux的jconsole：<a href=\"http://elf8848.iteye.com/blog/471676\" target=\"_blank\" rel=\"noopener\">http://elf8848.iteye.com/blog/471676</a></p>\n<p>慢查询：<a href=\"https://www.jianshu.com/p/43091bfa8aa7\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/p/43091bfa8aa7</a></p>\n<p>计算、IO阻塞两个部分</p>\n<h2 id=\"场景\"><a href=\"#场景\" class=\"headerlink\" title=\"场景\"></a>场景</h2><p>​    在性能好的服务器机子，可以接纳的并发数大，但是在一些Linux系统，资源有限，可能就没能提供这么大的并发数，这个时候就需要通过Linux系统的配置，来制定一个最优的服务器配置，达到最大可能的并发量。</p>\n<h2 id=\"Linux系统配置\"><a href=\"#Linux系统配置\" class=\"headerlink\" title=\"Linux系统配置\"></a>Linux系统配置</h2><h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><h4 id=\"磁盘\"><a href=\"#磁盘\" class=\"headerlink\" title=\"磁盘\"></a>磁盘</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df -h\t# 将磁盘容量通过易读的格式显示</span><br><span class=\"line\">df -m\t# 将通过以mb为单位，显示磁盘容量</span><br><span class=\"line\">df -k\t# 将通过以kb为单位，显示磁盘容量</span><br><span class=\"line\">du \t\t# 查看当前目录下文件的容量</span><br><span class=\"line\">du -a\t# 查看当前目录下所有文件的容量</span><br><span class=\"line\">du -sb /*\t# 查看当前目录下文件占用的容量，bytes为单位</span><br><span class=\"line\">du -sm /*\t# 查看当前目录下文件占用的容量，mb为单位</span><br></pre></td></tr></table></figure>\n<p>示例如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost Desktop]# df -h</span><br><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/sda2        18G  2.5G   15G  15% /</span><br><span class=\"line\">tmpfs           491M  224K  491M   1% /dev/shm</span><br><span class=\"line\">/dev/sda1       283M   36M  232M  14% /boot</span><br><span class=\"line\">[root@localhost Desktop]# df -hk</span><br><span class=\"line\">Filesystem     1K-blocks    Used Available Use% Mounted on</span><br><span class=\"line\">/dev/sda2       18208184 2582168  14694432  15% /</span><br><span class=\"line\">tmpfs             502384     372    502012   1% /dev/shm</span><br><span class=\"line\">/dev/sda1         289293   36855    237078  14% /boot</span><br><span class=\"line\">[root@localhost Desktop]# df -hm</span><br><span class=\"line\">Filesystem     1M-blocks  Used Available Use% Mounted on</span><br><span class=\"line\">/dev/sda2          17782  2522     14351  15% /</span><br><span class=\"line\">tmpfs                491     1       491   1% /dev/shm</span><br><span class=\"line\">/dev/sda1            283    36       232  14% /boot</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# du -a</span><br><span class=\"line\">4\t./.cshrc</span><br><span class=\"line\">4\t./.xauthi9aZjs</span><br><span class=\"line\">4\t./.bashrc</span><br><span class=\"line\">4\t./.bash_logout</span><br><span class=\"line\">4\t./.pki/nssdb</span><br><span class=\"line\">8\t./.pki</span><br><span class=\"line\">4\t./.bash_history</span><br><span class=\"line\">4\t./.bash_profile</span><br><span class=\"line\">12\t./install.log.syslog</span><br><span class=\"line\">4\t./.tcshrc</span><br><span class=\"line\">4\t./.xauth7a1Svt</span><br><span class=\"line\">4\t./.xauthbyRxSH</span><br><span class=\"line\">4\t./anaconda-ks.cfg</span><br><span class=\"line\">4\t./.xauthK4fQJz</span><br><span class=\"line\">48\t./install.log</span><br><span class=\"line\">116\t.</span><br><span class=\"line\">[root@localhost ~]# du -sm /*</span><br><span class=\"line\">8\t/bin</span><br><span class=\"line\">35\t/boot</span><br><span class=\"line\">1\t/dev</span><br><span class=\"line\">40\t/etc</span><br><span class=\"line\">21\t/home</span><br><span class=\"line\">170\t/lib</span><br><span class=\"line\">27\t/lib64</span><br><span class=\"line\">1\t/lost+found</span><br><span class=\"line\">1\t/media</span><br><span class=\"line\">1\t/mnt</span><br><span class=\"line\">1\t/opt</span><br><span class=\"line\">du: cannot access `/proc/3006/task/3006/fd/4': No such file or directory</span><br><span class=\"line\">du: cannot access `/proc/3006/task/3006/fdinfo/4': No such file or directory</span><br><span class=\"line\">du: cannot access `/proc/3006/fd/4': No such file or directory</span><br><span class=\"line\">du: cannot access `/proc/3006/fdinfo/4': No such file or directory</span><br><span class=\"line\">0\t/proc</span><br><span class=\"line\">1\t/root</span><br><span class=\"line\">15\t/sbin</span><br><span class=\"line\">0\t/selinux</span><br><span class=\"line\">1\t/srv</span><br><span class=\"line\">0\t/sys</span><br><span class=\"line\">1\t/tmp</span><br><span class=\"line\">2083\t/usr</span><br><span class=\"line\">257\t/var</span><br></pre></td></tr></table></figure>\n<h4 id=\"进程\"><a href=\"#进程\" class=\"headerlink\" title=\"进程\"></a>进程</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -lA\t# 查看系统所有的进程</span><br><span class=\"line\">ps -l\t# 查看仅自己bash的进程</span><br><span class=\"line\">ps aux\t# 查看系统所有的进程</span><br><span class=\"line\">ps aux --sort -pcpu\t# 根据CPU的占用比例来查看系统所有进程</span><br><span class=\"line\">ps aux --sort -pmem # 根据内存的占用比例来查看系统所有进程</span><br><span class=\"line\">ps aux --sort -pid \t# 根据pid由大到小来查看系统所有进程</span><br><span class=\"line\">top \t\t# 动态查看进程状况</span><br><span class=\"line\">top -d 5\t# 动态的，每5秒刷新一次，显示进程状况</span><br><span class=\"line\">top -d 10 -p 1\t# 动态的，每5秒刷新一次，显示PID为1的进程状况</span><br><span class=\"line\">kill -9 2333\t\t# 删除pid为2333的进程</span><br></pre></td></tr></table></figure>\n<p>示例如下（截取）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# ps -lA</span><br><span class=\"line\">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class=\"line\">4 S     0      1      0  0  80   0 -  4841 poll_s ?        00:00:02 init</span><br><span class=\"line\">1 S     0      2      0  0  80   0 -     0 kthrea ?        00:00:00 kthreadd</span><br><span class=\"line\">1 S     0      3      2  0 -40   - -     0 migrat ?        00:00:00 migration/0</span><br><span class=\"line\">1 S     0      4      2  0  80   0 -     0 ksofti ?        00:00:00 ksoftirqd/0</span><br><span class=\"line\">1 S     0      5      2  0 -40   - -     0 cpu_st ?        00:00:00 stopper/0</span><br><span class=\"line\">5 S     0      6      2  0 -40   - -     0 watchd ?        00:00:00 watchdog/0</span><br><span class=\"line\">1 S     0      7      2  0  80   0 -     0 worker ?        00:00:00 events/0</span><br><span class=\"line\">1 S     0      8      2  0  80   0 -     0 worker ?        00:00:00 events/0</span><br><span class=\"line\">[root@localhost ~]# ps aux</span><br><span class=\"line\">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class=\"line\">root          1  0.1  0.1  19364  1540 ?        Ss   14:09   0:02 /sbin/init</span><br><span class=\"line\">root          2  0.0  0.0      0     0 ?        S    14:09   0:00 [kthreadd]</span><br><span class=\"line\">root          3  0.0  0.0      0     0 ?        S    14:09   0:00 [migration/0]</span><br><span class=\"line\">root          4  0.0  0.0      0     0 ?        S    14:09   0:00 [ksoftirqd/0]</span><br><span class=\"line\">root          5  0.0  0.0      0     0 ?        S    14:09   0:00 [stopper/0]</span><br><span class=\"line\">root          6  0.0  0.0      0     0 ?        S    14:09   0:00 [watchdog/0]</span><br><span class=\"line\">root          7  0.0  0.0      0     0 ?        S    14:09   0:00 [events/0]</span><br><span class=\"line\">root          8  0.0  0.0      0     0 ?        S    14:09   0:00 [events/0]</span><br><span class=\"line\">root          9  0.0  0.0      0     0 ?        S    14:09   0:00 [events_long/0]</span><br><span class=\"line\">root         10  0.0  0.0      0     0 ?        S    14:09   0:00 [events_power_ef]</span><br><span class=\"line\">root         11  0.0  0.0      0     0 ?        S    14:09   0:00 [cgroup]</span><br><span class=\"line\">root         12  0.0  0.0      0     0 ?        S    14:09   0:00 [khelper]</span><br><span class=\"line\">[root@localhost ~]# ps -l</span><br><span class=\"line\">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class=\"line\">4 S     0   2934   2919  0  80   0 - 41308 wait   pts/0    00:00:00 su</span><br><span class=\"line\">4 S     0   2943   2934  0  80   0 - 27085 wait   pts/0    00:00:00 bash</span><br><span class=\"line\">4 R     0   3146   2943  0  80   0 - 27033 -      pts/0    00:00:00 ps</span><br><span class=\"line\">[root@localhost ~]# ps aux --sort -pcpu</span><br><span class=\"line\">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class=\"line\">root       2511  0.3  3.6 156432 36860 tty1     Ss+  14:10   0:08 /usr/bin/Xorg :0 -br -verbose -audit 4 -auth /var</span><br><span class=\"line\">root       1625  0.1  0.8 251432  8348 ?        Sl   14:10   0:03 /usr/sbin/vmtoolsd</span><br><span class=\"line\">pe         2827  0.1  1.6 269792 16608 ?        S    14:11   0:03 /usr/lib/vmware-tools/sbin64/vmtoolsd -n vmusr --</span><br><span class=\"line\">pe         2917  0.1  1.4 297200 14544 ?        Sl   14:11   0:02 /usr/bin/gnome-terminal -x /bin/sh -c cd '/home/p</span><br><span class=\"line\">root          1  0.0  0.1  19364  1540 ?        Ss   14:09   0:02 /sbin/init</span><br><span class=\"line\">root          2  0.0  0.0      0     0 ?        S    14:09   0:00 [kthreadd]</span><br><span class=\"line\">root          3  0.0  0.0      0     0 ?        S    14:09   0:00 [migration/0]</span><br><span class=\"line\">root          4  0.0  0.0      0     0 ?        S    14:09   0:00 [ksoftirqd/0]</span><br><span class=\"line\">[root@localhost ~]# ps aux --sort -pmem</span><br><span class=\"line\">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class=\"line\">root          1  0.0  0.1  19364  1540 ?        Ss   14:09   0:02 /sbin/init</span><br><span class=\"line\">root          2  0.0  0.0      0     0 ?        S    14:09   0:00 [kthreadd]</span><br><span class=\"line\">root          3  0.0  0.0      0     0 ?        S    14:09   0:00 [migration/0]</span><br><span class=\"line\">[root@localhost ~]# top</span><br><span class=\"line\">top - 15:00:30 up 50 min,  4 users,  load average: 0.00, 0.02, 0.00</span><br><span class=\"line\">Tasks: 143 total,   1 running, 142 sleeping,   0 stopped,   0 zombie</span><br><span class=\"line\">Cpu(s):  7.1%us,  1.0%sy,  0.0%ni, 91.8%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class=\"line\">Mem:   1004768k total,   925652k used,    79116k free,    86540k buffers</span><br><span class=\"line\">Swap:  2031612k total,        8k used,  2031604k free,   382244k cached</span><br><span class=\"line\">   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                     2511 root      20   0  198m  44m 8464 S  5.3  4.5   0:15.03 Xorg                       2917 pe        20   0  290m  14m 9756 S  2.0  1.5   0:05.45 gnome-terminal             2771 pe        20   0  404m  12m 9732 S  1.0  1.2   0:01.18 metacity                   1625 root      20   0  245m 8348 4812 S  0.7  0.8   0:04.55 vmtoolsd                   2791 pe        20   0  921m  21m  14m S  0.7  2.2   0:02.50 nautilus                   1694 root      20   0  505m 7884 4780 S  0.3  0.8   0:01.23 ManagementAgent             2755 pe        20   0  494m  11m 7916 S  0.3  1.2   0:00.66 gnome-settings-             2805 pe        20   0  298m  10m 8476 S  0.3  1.1   0:00.48 wnck-applet                 2827 pe        20   0  263m  16m  13m S  0.3  1.7   0:03.73 vmtoolsd                      1 root      20   0 19364 1540 1228 S  0.0  0.2   0:02.32 init                          2 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kthreadd                      3 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 migration/0               [root@localhost Desktop]# top -d 10 -p 1</span><br><span class=\"line\">top - 15:08:31 up 58 min,  4 users,  load average: 0.10, 0.03, 0.01</span><br><span class=\"line\">Tasks:   1 total,   0 running,   1 sleeping,   0 stopped,   0 zombie</span><br><span class=\"line\">Cpu(s):  1.1%us,  1.2%sy,  0.0%ni, 96.2%id,  1.5%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class=\"line\">Mem:   1004768k total,   929992k used,    74776k free,    86556k buffers</span><br><span class=\"line\">Swap:  2031612k total,        8k used,  2031604k free,   383544k cached</span><br><span class=\"line\">   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                        1 root      20   0 19364 1540 1228 S  0.0  0.2   0:02.32 init</span><br></pre></td></tr></table></figure>\n<h4 id=\"系统资源查看\"><a href=\"#系统资源查看\" class=\"headerlink\" title=\"系统资源查看\"></a>系统资源查看</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">free -m\t\t# 查看内存使用情况(mb)</span><br><span class=\"line\">free -b\t\t# 查看内存使用情况(byte)</span><br><span class=\"line\">free -t\t\t# 查看内存使用情况(kb),显示total</span><br><span class=\"line\">uptime\t\t# 查看系统启动时间、工作负载</span><br></pre></td></tr></table></figure>\n<p>示例结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost Desktop]# free -m</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:           981        918         62          3         85        423</span><br><span class=\"line\">-/+ buffers/cache:        410        571 </span><br><span class=\"line\">Swap:         1983          0       1983 </span><br><span class=\"line\">[root@localhost Desktop]# free -b</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:    1028882432  962957312   65925120    4022272   89210880  443887616</span><br><span class=\"line\">-/+ buffers/cache:  429858816  599023616 </span><br><span class=\"line\">Swap:   2080370688       8192 2080362496 </span><br><span class=\"line\">[root@localhost Desktop]# free -t</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:       1004768     940388      64380       3928      87120     433484</span><br><span class=\"line\">-/+ buffers/cache:     419784     584984 </span><br><span class=\"line\">Swap:      2031612          8    2031604 </span><br><span class=\"line\">Total:     3036380     940396    2095984</span><br><span class=\"line\">[root@localhost Desktop]# uptime</span><br><span class=\"line\"> 15:44:24 up  1:34,  4 users,  load average: 0.00, 0.00, 0.00</span><br></pre></td></tr></table></figure>\n<h4 id=\"网络\"><a href=\"#网络\" class=\"headerlink\" title=\"网络\"></a>网络</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat \t# 监控网络</span><br><span class=\"line\">netstat -a\t# 监控网络所有的连接、监听、Socket</span><br><span class=\"line\">netstat -t\t# 监控网络中tcp网络数据包</span><br><span class=\"line\">netstat -u\t# 监控网络中udp网络数据包</span><br><span class=\"line\">netstat -tlnp\t# 查看系统上已有监听的网络连接与其PID</span><br></pre></td></tr></table></figure>\n<p>示例如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost Desktop]# netstat -tlnp</span><br><span class=\"line\">Active Internet connections (only servers)</span><br><span class=\"line\">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </span><br><span class=\"line\">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      2272/sshd           </span><br><span class=\"line\">tcp        0      0 127.0.0.1:631               0.0.0.0:*                   LISTEN      2108/cupsd          </span><br><span class=\"line\">tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      2404/master         </span><br><span class=\"line\">tcp        0      0 :::22                       :::*                        LISTEN      2272/sshd           </span><br><span class=\"line\">tcp        0      0 ::1:631                     :::*                        LISTEN      2108/cupsd          </span><br><span class=\"line\">tcp        0      0 ::1:25                      :::*                        LISTEN      2404/master</span><br></pre></td></tr></table></figure>\n<h4 id=\"CPU\"><a href=\"#CPU\" class=\"headerlink\" title=\"CPU\"></a>CPU</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vmstat # 检查CPU、内存等的信息</span><br><span class=\"line\">vmstat -fs\t# 检查内存相关</span><br><span class=\"line\">vmstat -d\t# 检查系统磁盘的读写状态</span><br><span class=\"line\">vmstat 1 3\t# 每秒1次，记3次</span><br><span class=\"line\">cat /proc/cpuinfo |grep \"physical id\"|sort|uniq|wc -l\t# 查看系统物理cpu数</span><br><span class=\"line\">cat /proc/cpuinfo |grep \"cpu cores\"|wc -l\t\t\t\t# 查看系统cpu核数</span><br><span class=\"line\"> cat /proc/cpuinfo |grep \"processor\"|wc -l\t\t\t\t# 查看系统cpu总数</span><br></pre></td></tr></table></figure>\n<p>示例如下：</p>\n<figure class=\"highlight plain\"><figcaption><span>basic</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# cat /proc/cpuinfo</span><br><span class=\"line\">processor\t: 0</span><br><span class=\"line\">vendor_id\t: GenuineIntel</span><br><span class=\"line\">cpu family\t: 6</span><br><span class=\"line\">model\t\t: 63</span><br><span class=\"line\">model name\t: Intel(R) Xeon(R) CPU E5-2630 v3 @ 2.40GHz</span><br><span class=\"line\">stepping\t: 2</span><br><span class=\"line\">microcode\t: 0x36</span><br><span class=\"line\">cpu MHz\t\t: 2400.048</span><br><span class=\"line\">cache size\t: 20480 KB</span><br><span class=\"line\">physical id\t: 0</span><br><span class=\"line\">siblings\t: 1</span><br><span class=\"line\">core id\t\t: 0</span><br><span class=\"line\">cpu cores\t: 1</span><br><span class=\"line\">apicid\t\t: 0</span><br><span class=\"line\">initial apicid\t: 0</span><br><span class=\"line\">fpu\t\t: yes</span><br><span class=\"line\">fpu_exception\t: yes</span><br><span class=\"line\">cpuid level\t: 13</span><br><span class=\"line\">wp\t\t: yes</span><br><span class=\"line\">flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp lm constant_tsc rep_good nopl pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes f16c rdrand hypervisor lahf_lm abm fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid</span><br><span class=\"line\">bogomips\t: 4800.09</span><br><span class=\"line\">clflush size\t: 64</span><br><span class=\"line\">cache_alignment\t: 64</span><br><span class=\"line\">address sizes\t: 46 bits physical, 48 bits virtual</span><br><span class=\"line\">power management:</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# cat /proc/cpuinfo |grep &quot;physical id&quot;|sort|uniq|wc -l</span><br><span class=\"line\">1</span><br><span class=\"line\">[root@localhost ~]# cat /proc/cpuinfo |grep &quot;cpu cores&quot;|wc -l</span><br><span class=\"line\">1</span><br><span class=\"line\">[root@localhost ~]# cat /proc/cpuinfo |grep &quot;processor&quot;|wc -l</span><br><span class=\"line\">1</span><br><span class=\"line\">[root@localhost ~]# free -m</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:          1783       1701         82          1          0        668</span><br><span class=\"line\">-/+ buffers/cache:       1033        750</span><br><span class=\"line\">Swap:         3727       1793       1934</span><br><span class=\"line\">[root@localhost Desktop]# vmstat 1 3</span><br><span class=\"line\">procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----</span><br><span class=\"line\"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class=\"line\"> 0  0      8  68660  88456 429480    0    0    70    36   67  139  1  1 97  1  0\t</span><br><span class=\"line\"> 0  0      8  68660  88464 429476    0    0     0    16   57   88  0  0 99  1  0\t</span><br><span class=\"line\"> 0  0      8  68660  88464 429480    0    0     0     0   49   99  0  0 100  0  0\t</span><br><span class=\"line\">[root@localhost Desktop]# vmstat -d </span><br><span class=\"line\">disk- ------------reads------------ ------------writes----------- -----IO------</span><br><span class=\"line\">       total merged sectors      ms  total merged sectors      ms    cur    sec</span><br><span class=\"line\">ram0       0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">ram1       0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">ram2       0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">ram3       0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">loop1      0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">loop2      0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">loop3      0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">loop4      0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">sr0        0      0       0       0      0      0       0       0      0      0</span><br><span class=\"line\">disk- ------------reads------------ ------------writes----------- -----IO------</span><br><span class=\"line\">       total merged sectors      ms  total merged sectors      ms    cur    sec</span><br><span class=\"line\">sda    27022   8888  969508  131052   5571  56722  498324  895653      0    145</span><br></pre></td></tr></table></figure>\n<h2 id=\"Tomcat系统配置\"><a href=\"#Tomcat系统配置\" class=\"headerlink\" title=\"Tomcat系统配置\"></a>Tomcat系统配置</h2><h3 id=\"配置-1\"><a href=\"#配置-1\" class=\"headerlink\" title=\"配置\"></a>配置</h3><ol>\n<li>$CATALINA_HOME下bin\\catalina.sh、或者setenv.sh，添加JAVA的堆内存</li>\n<li>$CATALINA_HOME下conf\\server.xml，提高连接数</li>\n</ol>\n<h3 id=\"优化\"><a href=\"#优化\" class=\"headerlink\" title=\"优化\"></a>优化</h3><ol>\n<li>关闭tomcat进程，top查看free的数量，接着设置$CATALINA_HOME/bin/setenv.sh，分配80%的free数（例如2048MB，那么可以参考配置如下）</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">export</span> <span class=\"string\">CATALINA_OPTS=\"$CATALINA_OPTS</span> <span class=\"bullet\">-Xms1600m\"</span></span><br><span class=\"line\"><span class=\"string\">export</span> <span class=\"string\">CATALINA_OPTS=\"$CATALINA_OPTS</span> <span class=\"bullet\">-Xmx1600m\"</span></span><br><span class=\"line\"><span class=\"string\">export</span> <span class=\"string\">CATALINA_OPTS=\"$CATALINA_OPTS</span> <span class=\"attr\">-XX:MaxPermSize=256m\"</span></span><br><span class=\"line\"><span class=\"string\">export</span> <span class=\"string\">CATALINA_OPTS=\"$CATALINA_OPTS</span> <span class=\"attr\">-XX:+PrintGCDetails</span> <span class=\"attr\">-Xloggc:../logs/gc.log</span> <span class=\"attr\">-XX:+PrintGCTimeStamps\"</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>关于连接数的建议。当系统资源有限，甚至只有1个CPU，那么这里不建议用来做并发处理！假设，1000并发，那么1个CPU会很累，因为在切换线程的时间，会随着并发数的增加而狂增，时间都花在了切换线程上了，会导致很多线程响应超时！</li>\n<li>需要考虑，程序是以IO上传下载为主，还是计算为主。如果IO为主，可以考虑增加连接数maxThread；如果以计算为主，那么就需要减少maxThread了，为了得到更多的资源处理计算，避免并发数太多，时间与资源都花在线程切换上，导致计算时间不足。</li>\n</ol>\n<p>可以参考vmstat -d来查看读写；vmstat -fs查看内存相关</p>\n","next":{"title":"","slug":"about/积累方法"},"link":"https://pinksmallfan.github.io/WenChongAndJiaoKou/WenChongAndJiaoKou/2018/12/03/2018-12-3-Linux下最优的tomcat调优/","toc":[{"title":"场景","id":"场景","index":"1"},{"title":"Linux系统配置","id":"Linux系统配置","index":"2","children":[{"title":"配置","id":"配置","index":"2.1","children":[{"title":"磁盘","id":"磁盘","index":"2.1.1"},{"title":"进程","id":"进程","index":"2.1.2"},{"title":"系统资源查看","id":"系统资源查看","index":"2.1.3"},{"title":"网络","id":"网络","index":"2.1.4"},{"title":"CPU","id":"CPU","index":"2.1.5"}]}]},{"title":"Tomcat系统配置","id":"Tomcat系统配置","index":"3","children":[{"title":"配置","id":"配置-1","index":"3.1"},{"title":"优化","id":"优化","index":"3.2"}]}]}